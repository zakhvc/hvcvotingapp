<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Startup Voting Application</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Inter', 'sans-serif'],
            },
            colors: {
              primary: '#2D8BBA',
              secondary: '#10C0DF',
            },
          },
        },
      }
    </script>
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@18.2.0",
    "react-dom/client": "https://esm.sh/react-dom@18.2.0/client",
    "@supabase/supabase-js": "https://esm.sh/@supabase/supabase-js@2",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.1.1/",
    "react/": "https://aistudiocdn.com/react@^19.1.1/"
  }
}
</script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/babel" data-presets="react,typescript">
      // The entire application is bundled into this single script tag
      // to avoid MIME type errors when hosting on GitHub Pages.
      
      import React, { useState, useEffect, useMemo } from 'react';
      import ReactDOM from 'react-dom/client';
      import { createClient } from '@supabase/supabase-js';

      // --- FROM types.ts ---
      interface Startup {
        id: string;
        name: string;
        website?: string;
        founderLinkedIn?: string;
        deckUrl?: string;
      }

      enum VoteCategory {
        DemoDay = 'DEMO_DAY',
        PrivatePitch = 'PRIVATE_PITCH',
        None = 'NONE',
      }

      type Selections = Record<string, VoteCategory>;

      interface Ballot {
        id?: number;
        voterName: string;
        voterNameLower: string; // For case-insensitive voter lookup
        selections: Selections;
        timestamp: number;
      }

      // --- FROM constants.ts ---
      const DEMO_DAY_TARGET = 15;
      const PRIVATE_PITCH_TARGET = 20;
      const TOTAL_VOTES_TARGET = DEMO_DAY_TARGET + PRIVATE_PITCH_TARGET;
      const ADMIN_PASSWORD = 'hvcadminonly';

      // --- FROM supabaseClient.ts ---
      const supabaseUrl = '__SUPABASE_URL__';
      const supabaseAnonKey = '__SUPABASE_ANON_KEY__';

      if (supabaseUrl.startsWith('__') || supabaseAnonKey.startsWith('__')) {
        const rootDiv = document.getElementById('root');
        if(rootDiv) {
          rootDiv.innerHTML = `
            <div style="font-family: sans-serif; padding: 2rem; text-align: center; background: #FFFBEB; color: #B45309; border: 1px solid #FBBF24; margin: 1rem; border-radius: 0.5rem;">
              <h1>Configuration Error</h1>
              <p>The application cannot connect to the database because the API keys are missing.</p>
              <p>If you are the owner of this site, please check your GitHub Actions deployment workflow and repository secrets.</p>
            </div>
          `;
        }
        throw new Error('Supabase URL and/or Anon Key were not replaced during the build process.');
      }
      const supabase = createClient(supabaseUrl, supabaseAnonKey);

      // --- FROM components/ui/Button.tsx ---
      const Button = ({ children, className, variant = 'primary', ...props }) => {
        const baseClasses = 'px-6 py-2 rounded-lg font-semibold text-white transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-offset-2';
        const variantClasses = {
          primary: 'bg-secondary hover:bg-opacity-90 focus:ring-secondary disabled:bg-gray-400 disabled:cursor-not-allowed',
          secondary: 'bg-gray-500 hover:bg-gray-600 focus:ring-gray-500',
          ghost: 'bg-transparent text-primary hover:bg-blue-50',
        };
        return (
          <button
            className={`${baseClasses} ${variantClasses[variant]} ${className}`}
            {...props}
          >
            {children}
          </button>
        );
      };

      // --- FROM components/ui/Input.tsx ---
      const Input = ({ className, ...props }) => {
        return (
          <input
            className={`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent transition-colors duration-300 ${className}`}
            {...props}
          />
        );
      };

      // --- FROM components/ui/Modal.tsx ---
      const Modal = ({ isOpen, onClose, title, children }) => {
        if (!isOpen) return null;
        return (
          <div className="fixed inset-0 bg-black bg-opacity-50 z-50 flex justify-center items-center p-4">
            <div className="bg-white rounded-lg shadow-xl w-full max-w-md">
              <div className="p-6 border-b border-gray-200">
                <div className="flex justify-between items-center">
                  <h3 className="text-xl font-semibold text-gray-800">{title}</h3>
                  <button onClick={onClose} className="text-gray-400 hover:text-gray-600">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
              </div>
              <div className="p-6">{children}</div>
            </div>
          </div>
        );
      };
      
      // --- FROM components/StartupCard.tsx ---
      const StartupCard = ({ startup, selection, onSelect, isDisabled }) => {
        const [iconError, setIconError] = useState(false);
        useEffect(() => { setIconError(false); }, [startup.id]);
        const getCardStyle = (category) => {
          switch (category) {
            case VoteCategory.DemoDay: return 'border-primary bg-blue-50 shadow-md';
            case VoteCategory.PrivatePitch: return 'border-secondary bg-cyan-50 shadow-md';
            default: return 'border-gray-200 bg-white hover:shadow-lg';
          }
        };
        const hasLinks = startup.website || startup.founderLinkedIn || startup.deckUrl;
        const iconUrl = startup.website && !iconError ? `https://www.google.com/s2/favicons?sz=64&domain_url=${startup.website}` : null;
        return (
          <div className={`p-4 border rounded-lg transition-all duration-300 flex flex-col justify-between ${getCardStyle(selection)}`}>
            <div>
              <div className="h-14 flex items-center justify-center mb-2">
                {iconUrl ? (
                  <img src={iconUrl} alt={`${startup.name} logo`} className="w-12 h-12 object-contain rounded-md" onError={() => setIconError(true)} loading="lazy" />
                ) : (
                  <div className="w-12 h-12 bg-gray-200 rounded-md flex items-center justify-center text-gray-400">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>
                  </div>
                )}
              </div>
              <h3 className="font-semibold text-gray-800 text-center truncate h-12 flex items-center justify-center">{startup.name}</h3>
              <div className="mt-2 flex justify-center space-x-2">
                <button onClick={() => onSelect(startup.id, VoteCategory.DemoDay)} disabled={isDisabled(VoteCategory.DemoDay) && selection !== VoteCategory.DemoDay} className={`px-3 py-1 text-xs font-medium rounded-full transition-colors ${selection === VoteCategory.DemoDay ? 'bg-primary text-white' : 'bg-gray-200 text-gray-700 hover:bg-blue-200 disabled:bg-gray-100 disabled:text-gray-400'}`}>Demo</button>
                <button onClick={() => onSelect(startup.id, VoteCategory.PrivatePitch)} disabled={isDisabled(VoteCategory.PrivatePitch) && selection !== VoteCategory.PrivatePitch} className={`px-3 py-1 text-xs font-medium rounded-full transition-colors ${selection === VoteCategory.PrivatePitch ? 'bg-secondary text-white' : 'bg-gray-200 text-gray-700 hover:bg-cyan-200 disabled:bg-gray-100 disabled:text-gray-400'}`}>Private</button>
              </div>
            </div>
            {hasLinks && (
              <div className="mt-4 pt-3 border-t border-gray-200 flex justify-center items-center space-x-4">
                {startup.website && (<a href={startup.website} target="_blank" rel="noopener noreferrer" title="Website" className="text-gray-400 hover:text-primary transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M21 12a9 9 0 01-9 9m9-9a9 9 0 00-9-9m9 9H3m9 9a9 9 0 01-9-9m9 9V3m0 18a9 9 0 009-9M3 12a9 9 0 019-9m0 18a9 9 0 00-9-9m9 9V3" /></svg></a>)}
                {startup.founderLinkedIn && (<a href={startup.founderLinkedIn} target="_blank" rel="noopener noreferrer" title="Founder LinkedIn" className="text-gray-400 hover:text-primary transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="currentColor" viewBox="0 0 24 24"><path d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" /></svg></a>)}
                {startup.deckUrl && (<a href={startup.deckUrl} target="_blank" rel="noopener noreferrer" title="Startup Deck" className="text-gray-400 hover:text-primary transition-colors"><svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2}><path strokeLinecap="round" strokeLinejoin="round" d="M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z" /></svg></a>)}
              </div>
            )}
          </div>
        );
      };
      
      // --- FROM components/EditStartupModal.tsx ---
      const EditStartupModal = ({ startup, onClose, onSave }) => {
        const [formData, setFormData] = useState({});
        const isEditMode = !!startup;
        useEffect(() => { setFormData(startup || { name: '', website: '', founderLinkedIn: '', deckUrl: '' }); }, [startup]);
        const handleChange = (e) => { const { name, value } = e.target; setFormData(prev => ({ ...prev, [name]: value })); };
        const handleSubmit = (e) => {
          e.preventDefault();
          if (!formData.name || formData.name.trim() === '') { alert('Startup name is required.'); return; }
          const processedData = { ...formData };
          const urlFields = ['website', 'founderLinkedIn', 'deckUrl'];
          urlFields.forEach(field => {
            const url = processedData[field];
            if (url && typeof url === 'string' && url.trim() !== '') {
              const trimmedUrl = url.trim();
              if (!/^https?:\/\//i.test(trimmedUrl)) { processedData[field] = `https://${trimmedUrl}`; } else { processedData[field] = trimmedUrl; }
            } else { processedData[field] = undefined; }
          });
          onSave(processedData);
        };
        return (
          <Modal isOpen={true} onClose={onClose} title={isEditMode ? `Edit ${startup.name}` : 'Add New Startup'}>
            <form onSubmit={handleSubmit} className="space-y-4">
              <div><label className="block text-sm font-medium text-gray-700" htmlFor="startupName">Startup Name</label><Input id="startupName" type="text" name="name" value={formData.name || ''} onChange={handleChange} required className="mt-1" /></div>
              <div><label className="block text-sm font-medium text-gray-700" htmlFor="website">Website URL</label><Input id="website" type="text" name="website" placeholder="example.com" value={formData.website || ''} onChange={handleChange} className="mt-1" /></div>
              <div><label className="block text-sm font-medium text-gray-700" htmlFor="founderLinkedIn">Founder LinkedIn URL</label><Input id="founderLinkedIn" type="text" name="founderLinkedIn" placeholder="linkedin.com/in/founder" value={formData.founderLinkedIn || ''} onChange={handleChange} className="mt-1" /></div>
              <div><label className="block text-sm font-medium text-gray-700" htmlFor="deckUrl">Deck URL</label><Input id="deckUrl" type="text" name="deckUrl" placeholder="deck.com/slide" value={formData.deckUrl || ''} onChange={handleChange} className="mt-1" /></div>
              <div className="flex justify-end gap-2 pt-4"><Button type="button" onClick={onClose} variant="secondary">Cancel</Button><Button type="submit">{isEditMode ? 'Save Changes' : 'Add Startup'}</Button></div>
            </form>
          </Modal>
        );
      };

      // --- FROM components/VoterLogin.tsx ---
      const VoterLogin = ({ onLogin, onAdminAction }) => {
        const [name, setName] = useState('');
        const handleSubmit = (e) => {
          e.preventDefault();
          if (name.trim()) { onLogin(name.trim()); } else { alert("Please enter your name."); }
        };
        return (
          <div className="min-h-screen flex items-center justify-center bg-gray-50 p-4">
            <div className="w-full max-w-md p-8 space-y-8 bg-white shadow-lg rounded-xl">
              <div className="text-center"><h1 className="text-2xl sm:text-3xl font-bold text-primary">Welcome to HVC Accelerator Cohort 003 Startup Voting</h1></div>
              <form onSubmit={handleSubmit} className="space-y-4">
                <div>
                  <label htmlFor="voterName" className="text-sm font-medium text-gray-700 sr-only">Voter Name</label>
                  <Input id="voterName" type="text" placeholder="Enter your name to start" value={name} onChange={(e) => setName(e.target.value)} required />
                  <p className="mt-2 text-xs text-gray-500 text-center">(Each startup can only vote once)</p>
                </div>
                <Button type="submit" className="w-full">Start Voting</Button>
              </form>
              <div className="text-center border-t pt-4 flex justify-center items-center space-x-4">
                <button onClick={() => onAdminAction('results')} className="font-medium text-sm text-primary hover:text-secondary transition-colors">View Results</button>
                <button onClick={() => onAdminAction('admin')} className="font-medium text-sm text-primary hover:text-secondary transition-colors">Admin Access</button>
              </div>
            </div>
          </div>
        );
      };

      // --- FROM components/AdminPanel.tsx ---
      const AdminPanel = ({ startups, onUpdateStartup, onAddStartup, onDeleteStartup, onBack }) => {
        const [modalState, setModalState] = useState(null);
        const handleSave = (formData) => {
          if ('id' in formData) { onUpdateStartup(formData); } else { onAddStartup(formData); }
          setModalState(null);
        };
        const handleDelete = (startupId) => {
          if (window.confirm('Are you sure you want to delete this startup? This will also remove any votes cast for it. This action cannot be undone.')) { onDeleteStartup(startupId); }
        };
        const renderLink = (url) => {
          if (!url) return <span className="text-gray-400">Not set</span>;
          return <a href={url} target="_blank" rel="noopener noreferrer" className="text-primary hover:underline truncate" style={{maxWidth: '150px', display: 'inline-block'}}>{url}</a>;
        };
        return (
          <div className="min-h-screen bg-gray-100 p-4 sm:p-8">
            <div className="max-w-7xl mx-auto">
              <header className="flex flex-col sm:flex-row justify-between sm:items-center mb-8 gap-4">
                <div>
                  <h1 className="text-3xl sm:text-4xl font-bold text-primary">Admin Panel</h1>
                  <p className="text-gray-600 mt-1">Manage startup information, add new startups, or remove them.</p>
                </div>
                <div className="flex-shrink-0 flex gap-4"><Button onClick={() => setModalState({ mode: 'add' })}>Add New Startup</Button><Button onClick={onBack} variant="secondary">Back to Home</Button></div>
              </header>
              <div className="bg-white shadow-md rounded-lg overflow-x-auto">
                <table className="min-w-full divide-y divide-gray-200">
                  <thead className="bg-gray-50">
                    <tr>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Startup Name</th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Website</th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">LinkedIn</th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Deck</th>
                      <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                  </thead>
                  <tbody className="bg-white divide-y divide-gray-200">
                    {startups.map(startup => (
                      <tr key={startup.id}>
                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{startup.name}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{renderLink(startup.website)}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{renderLink(startup.founderLinkedIn)}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">{renderLink(startup.deckUrl)}</td>
                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                          <Button onClick={() => setModalState({ mode: 'edit', startup })} variant="ghost" className="text-primary hover:text-secondary p-2">Edit</Button>
                          <Button onClick={() => handleDelete(startup.id)} variant="ghost" className="text-red-600 hover:text-red-800 p-2">Delete</Button>
                        </td>
                      </tr>
                    ))}
                  </tbody>
                </table>
              </div>
            </div>
            {modalState && <EditStartupModal startup={modalState.startup} onClose={() => setModalState(null)} onSave={handleSave} />}
          </div>
        );
      };

      // --- FROM components/ResultsPage.tsx ---
      const ResultsPage = ({ ballots, onBack, startups }) => {
        const results = useMemo(() => {
          const demoDayVotes = {}; const privatePitchVotes = {};
          for (const ballot of ballots) {
            for (const startupId in ballot.selections) {
              const category = ballot.selections[startupId];
              if (category === VoteCategory.DemoDay) {
                if (!demoDayVotes[startupId]) { demoDayVotes[startupId] = { count: 0, voters: [] }; }
                demoDayVotes[startupId].count++; demoDayVotes[startupId].voters.push(ballot.voterName);
              } else if (category === VoteCategory.PrivatePitch) {
                if (!privatePitchVotes[startupId]) { privatePitchVotes[startupId] = { count: 0, voters: [] }; }
                privatePitchVotes[startupId].count++; privatePitchVotes[startupId].voters.push(ballot.voterName);
              }
            }
          }
          const sortedDemoDay = Object.entries(demoDayVotes).sort(([, a], [, b]) => b.count - a.count);
          const sortedPrivatePitch = Object.entries(privatePitchVotes).sort(([, a], [, b]) => b.count - a.count);
          return { sortedDemoDay, sortedPrivatePitch };
        }, [ballots]);
        const startupNameMap = startups.reduce((acc, s) => { acc[s.id.toString()] = s.name; return acc; }, {});
        const ResultList = ({ title, data, color }) => {
          const [expandedItems, setExpandedItems] = useState(new Set());
          const toggleExpansion = (startupId) => {
            setExpandedItems(prev => { const newSet = new Set(prev); if (newSet.has(startupId)) { newSet.delete(startupId); } else { newSet.add(startupId); } return newSet; });
          };
          return (
            <div className="bg-white p-6 rounded-lg shadow">
              <h2 className={`text-2xl font-bold mb-4 ${color}`}>{title}</h2>
              {data.length > 0 ? (
                <ol className="space-y-2">
                  {data.map(([startupId, { count, voters }], index) => {
                    const isExpanded = expandedItems.has(startupId);
                    return (
                      <li key={startupId} className="bg-gray-50 rounded-md overflow-hidden transition-all duration-300">
                        <div onClick={() => toggleExpansion(startupId)} className="flex items-center justify-between p-3 cursor-pointer hover:bg-gray-100" aria-expanded={isExpanded}>
                          <div className="flex items-center"><span className="text-lg font-bold text-gray-500 w-8">{index + 1}.</span><span className="font-medium text-gray-800">{startupNameMap[startupId] || `Startup ID: ${startupId}`}</span></div>
                          <div className="flex items-center gap-4"><span className="font-bold text-gray-700">{count} vote{count !== 1 ? 's' : ''}</span><svg xmlns="http://www.w3.org/2000/svg" className={`h-5 w-5 text-gray-500 transition-transform ${isExpanded ? 'rotate-180' : ''}`} viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clipRule="evenodd" /></svg></div>
                        </div>
                        {isExpanded && (<div className="px-4 pb-3 pt-1 pl-14 bg-gray-50"><h4 className="text-sm font-semibold text-gray-600 mb-1">Voted by:</h4><ul className="list-disc list-inside text-sm text-gray-600 space-y-1">{voters.sort().map((voter, i) => (<li key={i}>{voter}</li>))}</ul></div>)}
                      </li>
                    )
                  })}
                </ol>
              ) : (<p className="text-gray-500">No votes have been cast in this category yet.</p>)}
            </div>
          )
        };
        return (
          <div className="min-h-screen bg-gray-100 p-8">
            <div className="max-w-6xl mx-auto">
              <header className="flex justify-between items-center mb-8"><h1 className="text-4xl font-bold text-primary">Voting Results</h1><Button onClick={onBack}>Back to Home</Button></header>
              <div className="grid md:grid-cols-2 gap-8"><ResultList title="Demo Day Pitch" data={results.sortedDemoDay} color="text-primary" /><ResultList title="Private Pitch" data={results.sortedPrivatePitch} color="text-secondary" /></div>
            </div>
          </div>
        );
      };

      // --- FROM components/VotingSystem.tsx ---
      const VotingSystem = ({ voterName, onSubmit, startups, onAdminAction }) => {
        const [selections, setSelections] = useState(() => startups.reduce((acc, s) => ({ ...acc, [s.id]: VoteCategory.None }), {}));
        const counts = useMemo(() => {
          return Object.values(selections).reduce((acc, category) => {
            if (category === VoteCategory.DemoDay) acc.demoDay++; if (category === VoteCategory.PrivatePitch) acc.privatePitch++; return acc;
          }, { demoDay: 0, privatePitch: 0 });
        }, [selections]);
        const handleSelect = (startupId, category) => {
          const currentSelection = selections[startupId];
          if (currentSelection === category) { setSelections(prev => ({ ...prev, [startupId]: VoteCategory.None })); return; }
          if (category === VoteCategory.DemoDay && counts.demoDay >= DEMO_DAY_TARGET) { alert(`You can only select ${DEMO_DAY_TARGET} startups for Demo Day.`); return; }
          if (category === VoteCategory.PrivatePitch && counts.privatePitch >= PRIVATE_PITCH_TARGET) { alert(`You can only select ${PRIVATE_PITCH_TARGET} startups for Private Pitch.`); return; }
          setSelections(prev => ({ ...prev, [startupId]: category }));
        };
        const isCategoryFull = (category) => {
          if (category === VoteCategory.DemoDay) return counts.demoDay >= DEMO_DAY_TARGET;
          if (category === VoteCategory.PrivatePitch) return counts.privatePitch >= PRIVATE_PITCH_TARGET;
          return false;
        };
        const isSubmissionValid = counts.demoDay === DEMO_DAY_TARGET && counts.privatePitch === PRIVATE_PITCH_TARGET;
        const handleSubmit = () => {
          if (isSubmissionValid) { const ballot = { voterName, voterNameLower: voterName.toLowerCase(), selections, timestamp: Date.now() }; onSubmit(ballot); } 
          else { alert("Please ensure you have selected exactly 15 for Demo Day and 20 for Private Pitch."); }
        };
        const ProgressBar = ({count, target, color, name}) => (
          <div className="w-full">
            <div className="flex justify-between mb-1"><span className="text-sm font-medium text-gray-700">{name}</span><span className={`text-sm font-medium ${count === target ? 'text-green-600' : 'text-gray-700'}`}>{count} / {target}</span></div>
            <div className="w-full bg-gray-200 rounded-full h-2.5"><div className={`${color} h-2.5 rounded-full transition-all duration-500`} style={{ width: `${(count / target) * 100}%` }}></div></div>
          </div>
        );
        return (
          <div className="min-h-screen bg-gray-50 p-4 sm:p-6 lg:p-8">
            <div className="max-w-7xl mx-auto">
              <header className="bg-white shadow rounded-lg p-6 mb-8 sticky top-4 z-10">
                <div className="flex flex-col md:flex-row justify-between items-center gap-6">
                  <div className="flex-1"><h1 className="text-2xl font-bold text-primary">Vote for Startups</h1><p className="text-gray-600">Welcome, {voterName}. Select exactly {DEMO_DAY_TARGET} for Demo Day and {PRIVATE_PITCH_TARGET} for Private Pitch.</p></div>
                  <div className="w-full md:w-1/2 lg:w-1/3 flex flex-col gap-4"><ProgressBar count={counts.demoDay} target={DEMO_DAY_TARGET} color="bg-primary" name="Demo Day Pitch"/><ProgressBar count={counts.privatePitch} target={PRIVATE_PITCH_TARGET} color="bg-secondary" name="Private Pitch"/></div>
                  <div className="flex flex-col items-center md:items-end gap-2">
                    <Button onClick={handleSubmit} disabled={!isSubmissionValid} className="w-full">Submit My Votes</Button>
                    <div className="flex justify-center items-center space-x-4 text-sm"><button onClick={() => onAdminAction('admin')} className="font-medium text-primary hover:text-secondary transition-colors">Admin Panel</button><span className="text-gray-300">|</span><button onClick={() => onAdminAction('results')} className="font-medium text-primary hover:text-secondary transition-colors">View Results</button></div>
                  </div>
                </div>
              </header>
              <main className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
                {startups.map(startup => (<StartupCard key={startup.id} startup={startup} selection={selections[startup.id]} onSelect={handleSelect} isDisabled={isCategoryFull} />))}
              </main>
            </div>
          </div>
        );
      };

      // --- FROM App.tsx ---
      const App = () => {
        const [voterName, setVoterName] = useState(null);
        const [currentView, setCurrentView] = useState('Loading');
        const [ballots, setBallots] = useState([]);
        const [startups, setStartups] = useState([]);
        const [isPasswordModalOpen, setIsPasswordModalOpen] = useState(false);
        const [password, setPassword] = useState('');
        const [passwordError, setPasswordError] = useState('');
        const [adminAction, setAdminAction] = useState(null);

        useEffect(() => {
          const fetchData = async () => {
            try {
              const { data: startupsData, error: startupsError } = await supabase.from('startups').select('*').order('name', { ascending: true });
              if (startupsError) throw startupsError;
              setStartups(startupsData || []);
              const { data: ballotsData, error: ballotsError } = await supabase.from('ballots').select('*');
              if (ballotsError) throw ballotsError;
              setBallots(ballotsData || []);
            } catch (error) {
              console.error('Error fetching data:', error);
              alert('Failed to load data from the server. Please check your connection and refresh the page.');
            } finally {
              setCurrentView('Login');
            }
          };
          fetchData();
        }, []);
        
        const handleLogin = (name) => {
          const trimmedName = name.trim();
          const hasVoted = ballots.some((ballot) => ballot.voterNameLower === trimmedName.toLowerCase());
          if (hasVoted) { alert("This name has already voted."); return; }
          setVoterName(trimmedName);
          setCurrentView('Voting');
        };
        const handleVoteSubmit = async (ballot) => {
          try {
            const { data, error } = await supabase.from('ballots').insert([ballot]).select();
            if (error) throw error;
            if (data) { setBallots(prevBallots => [...prevBallots, data[0]]); setCurrentView('ThankYou'); }
          } catch (error) { console.error('Error submitting vote:', error); alert('There was an error submitting your vote. Please try again.'); }
        };
        const handleOpenPasswordModal = (action) => {
          setAdminAction(action); setIsPasswordModalOpen(true); setPasswordError(''); setPassword('');
        };
        const handlePasswordCheck = () => {
          if (password === ADMIN_PASSWORD) {
            if (adminAction === 'results') { setCurrentView('Results'); } else if (adminAction === 'admin') { setCurrentView('Admin'); }
            setIsPasswordModalOpen(false); setAdminAction(null);
          } else { setPasswordError('Incorrect password. Please try again.'); }
        };
        const handleUpdateStartup = async (updatedStartup) => {
          try {
            const { data, error } = await supabase.from('startups').update(updatedStartup).eq('id', updatedStartup.id).select();
            if (error) throw error;
            if (data) { setStartups(prevStartups => prevStartups.map(s => s.id === updatedStartup.id ? data[0] : s)); }
          } catch (error) { console.error('Error updating startup:', error); alert('Failed to update startup. Please try again.'); }
        };
        const handleAddStartup = async (newStartupData) => {
          try {
            const { data, error } = await supabase.from('startups').insert(newStartupData).select();
            if (error) throw error;
            if (data) { setStartups(prevStartups => [...prevStartups, data[0]]); }
          } catch (error) { console.error('Error adding startup:', error); alert('Failed to add startup. Please try again.'); }
        };
        const handleDeleteStartup = async (startupId) => {
          try {
            const { error } = await supabase.from('startups').delete().eq('id', startupId);
            if (error) throw error;
            setStartups(prevStartups => prevStartups.filter(s => s.id !== startupId));
          } catch (error) { console.error('Error deleting startup:', error); alert('Failed to delete startup. Please try again.'); }
        };
        const renderView = () => {
          switch (currentView) {
            case 'Loading': return <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50 text-center p-4"><h1 className="text-2xl font-bold text-primary animate-pulse">Loading Application...</h1></div>;
            case 'Login': return <VoterLogin onLogin={handleLogin} onAdminAction={handleOpenPasswordModal} />;
            case 'Voting': return <VotingSystem voterName={voterName} onSubmit={handleVoteSubmit} startups={startups} onAdminAction={handleOpenPasswordModal} />;
            case 'Results': return <ResultsPage ballots={ballots} onBack={() => setCurrentView('Login')} startups={startups} />;
            case 'ThankYou': return <div className="flex flex-col items-center justify-center min-h-screen bg-gray-50 text-center p-4"><h1 className="text-4xl font-bold text-primary mb-4">Thank You!</h1><p className="text-lg text-gray-700">Your vote has been successfully submitted.</p><Button onClick={() => setCurrentView('Login')} className="mt-8">Back to Home</Button></div>;
            case 'Admin': return <AdminPanel startups={startups} onUpdateStartup={handleUpdateStartup} onAddStartup={handleAddStartup} onDeleteStartup={handleDeleteStartup} onBack={() => setCurrentView('Login')} />;
            default: return <VoterLogin onLogin={handleLogin} onAdminAction={handleOpenPasswordModal} />;
          }
        };
        return (
          <div className="bg-gray-100 min-h-screen font-sans">
            {renderView()}
            <Modal isOpen={isPasswordModalOpen} onClose={() => setIsPasswordModalOpen(false)} title="Admin Access Required">
              <div className="space-y-4">
                <p className="text-gray-600">Please enter the admin password to continue.</p>
                <Input type="password" placeholder="Password" value={password} onChange={(e) => setPassword(e.target.value)} onKeyDown={(e) => e.key === 'Enter' && handlePasswordCheck()} />
                {passwordError && <p className="text-red-500 text-sm">{passwordError}</p>}
                <div className="flex justify-end gap-2"><Button onClick={() => setIsPasswordModalOpen(false)} variant="secondary">Cancel</Button><Button onClick={handlePasswordCheck}>Submit</Button></div>
              </div>
            </Modal>
          </div>
        );
      };

      // --- FROM index.tsx ---
      const rootElement = document.getElementById('root');
      if (!rootElement) { throw new Error("Could not find root element to mount to"); }
      const root = ReactDOM.createRoot(rootElement);
      root.render(<React.StrictMode><App /></React.StrictMode>);
    </script>
  </body>
</html>
